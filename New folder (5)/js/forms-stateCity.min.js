$(document).ready(function () {

    var countryCode = $(".country-state").attr("countrySelected");
    var fetchCountryStateServlet = $(".country-state").attr("data-csc-api");
    var selectCityText = $("#city").attr("cityPlaceholder");
    var dealerCityApi = $(".country-state").attr("data-dealer");

    function showDialog(message) {
        $("body").addClass("modal-open");
        $("#CitymyModal").addClass("show");
        $("#CitymyModal").attr("aria-hidden", "false");
        $('<div class="modal-backdrop fade show"><div>').insertAfter("#CitymyModal");
        $("#citymessage").html(message);
        $("#CitymyModal").css("display", "block");

        $(document).on("click", ".close-modal-btn", function (e) {
            $("body").removeClass("modal-open");
            $("#CitymyModal").removeClass("show");
            $("#CitymyModal").attr("aria-hidden", "true");
            $("#CitymyModal").css("display", "none");
            $(".modal-backdrop").remove();
        });
    }


    $.ajax({
        url: fetchCountryStateServlet + "?countryCode=" + countryCode,
        type: "GET",
        contentType: "application/json",
        success: function (result) {
            var stateKeys = Object.keys(result);
            for (i = 0; i < stateKeys.length; i++) {
                var state = result[stateKeys[i]];
                $("#state").append("<option value='" + stateKeys[i] + "'>" + state + "</option>");
            }
        },
        error: function () {
            //console.log("fail");
        }
    });

    $("#state").change(function () {
        $("#city").empty().append('<option selected="selected" value="">' + selectCityText + '</option>');
        stateCode = $("#state option:selected").val();
        if(stateCode){
        $.ajax({
            url: fetchCountryStateServlet + "?countryCode=" + countryCode + "&stateCode=" + stateCode,
            type: "GET",
            contentType: "application/json",
            success: function (result) {
                var cityKeys = Object.keys(result);
                for (i = 0; i < cityKeys.length; i++) {
                    var city = result[cityKeys[i]];
                    $("#city").append("<option value='" + cityKeys[i] + "'>" + city + "</option>");
                }
            },
            error: function () {
                //console.log("fail");
            }
        });
    }
    });
    
    var inputSC = document.getElementById("citySuggestion");
    if(inputSC!= null && inputSC!= undefined && inputSC.length> 0){
    var awesompleteSC = new Awesomplete(inputSC, {
        minChars: 3, 
        autoFirst: true,
        maxItems: 500
     });
    }
    $(".visually-hidden").hide();
    var cityArr = [];
    if($("#citySuggestion").attr("city-suggestionbox") == "true"){
    $("#citySuggestion").on("input", function () {
        let cityValueData = $(this).val();
        var CArr = "";
        var passwAl = /^[-'a-zA-Z ]+$/;
        if ((!passwAl.test(cityValueData) && cityValueData != "")|| cityValueData == "") {
            var cityValueDatastr = cityValueData.substring(0, cityValueData.length - 1);
            $("#citySuggestion").val(cityValueDatastr);
        }
        if (cityValueData.length > 3) {
            cityArr = [];
            $.ajax({
                url:  dealerCityApi + "?city=" + cityValueData + "&country=" + countryCode,
                type: "GET",
                success: function(res) {
                    if(res.code == 200){
                        cityArr.push(res.data);
                        CArr= res.data;
                        awesompleteSC.list = CArr;
                    }else if(res.code == 404){
                        showDialog($("#citySuggestion").attr("invaild-data"));
                       $("#citySuggestion").val("");
                       $("#citySuggestion").blur();
                    }
                },
                error: function(error) {
                }
            });
        }else{
            CArr = [];
            awesompleteBTR.list = CArr;
        }
    });

     $("#citySuggestion").blur(function(){
        var inputVaue = $(this).val();
        if(cityArr[0].includes(inputVaue) && inputVaue != ""){
        }else if(inputVaue != ""){
            showDialog($("#citySuggestion").attr("invaild-data"));
            $("#citySuggestion").val("");
        }
    });
}
});
$(function(){
$(document).on("change",".stateAna",function(){
let statePlaceholderText = $(this).attr('data-placeholder');
let cityPlaceholderText = $('#city').attr('data-placeholder');
    dataLayer.push({
    'event':'stateCity',
    'eventCategory':'stateCity',
    'eventAction':statePlaceholderText,
    'eventLabel':"state",
    'state':$(this).find('option:selected').text().trim(),
    'city':cityPlaceholderText
});
    });
$(document).on("change",".cityAna",function(){
let statePlaceholderText = $(this).attr('data-placeholder');
let cityPlaceholderText = $('#city').attr('data-placeholder');
let stateValue = $("#state").find('option:selected').text().trim();
    dataLayer.push({
    'event':'stateCity',
    'eventCategory':'stateCity',
    'eventAction':cityPlaceholderText,
    'eventLabel':"city",
    'state':stateValue,
    'city':$(this).find('option:selected').text().trim()
});
    });

});
$(document).ready(function () {
    if ($(window).width() <= 767) {
        $(".col-item").each(function () {
            $(this).removeClass("col");
            $(this).addClass("col-sm-12");
        });
    }

    $(window).resize(function () {
        if ($(window).width() <= 767) {
            $(".col-item").each(function () {
                $(this).removeClass("col");
                $(this).addClass("col-sm-12");
            });
        } else {
            $(".col-item").each(function () {
                $(this).removeClass("col-sm-12");
                $(this).addClass("col");
            });
        }
    });
});

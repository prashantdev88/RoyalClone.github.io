$(document).ready(function(){
    //console.log("Ready");
    var authDate;
    var ridersLimit = parseInt($('.ridersLimit').attr('data-attr-ridersLimit'));
    var formName = $('.ridersLimit').attr('data-attr-formName');
    var registerButtonText = $('.regButton').attr('data-attr-regsiterText');
    var registerButtonUrl = $('.regButton').attr('data-attr-registerUrl') + ".html";
    var detailButtonText = $('.regButton').attr('data-attr-detailPageText');
    var detailButtonUrl = $('.regButton').attr('data-attr-detailPageUrl');
    var registerEndDate = $(".ridersLimit").attr("data-attr-date");
    var verifyUrl = $(".ridersLimit").attr("data-verify");
    
    if(registerEndDate != "" && typeof(registerEndDate) != "undefined"){
        var d=registerEndDate.split("-");
        var day = d[1]+"-"+d[0]+"-"+d[2];
        authDate = new Date(day);
    }
    if(detailButtonUrl == undefined){
        detailButtonUrl = $('.regButton').attr('data-attr-registerurl');
    }
    
    if(ridersLimit){
    // $.ajax({
    //     url : verifyUrl,
    //     type : "Post",
    //     data : {ridersLimit : ridersLimit,formName : formName },
    //     success : function(res){
    //                 //console.log(res);
    //                 var date = new Date(res.date);
    //                 if(authDate <= date){
    //                     $('.regButton').html(detailButtonText);
    //                     $('.regButton').attr('href',detailButtonUrl)
    //                 }else if(res.status == 400){
                    
    //                     $('.regButton').html(detailButtonText);
    //                     $('.regButton').attr('href',detailButtonUrl)

    //                 }else{
    
    //                     $('.regButton').html(registerButtonText);
    //                     $('.regButton').attr('href',registerButtonUrl)
    //                 }
    //     },error : function(err){
    //             //console.log(err)
    //     }
    
    // });
    detailButtonUrl = detailButtonUrl.replace("/content/royal-enfield","");
    $('.regButton').html(detailButtonText);
    $('.regButton').attr('href',detailButtonUrl)
    }else{
        $('.regButton').html(detailButtonText);
        $('.regButton').attr('href',detailButtonUrl)
    }
    });
    

$(function(){
    function maqueeRideAnalytics(ctaText,nextPageURL,duration,price,date,destination,terrain,distance,origin){
        dataLayer.push({
            'event':'marqueeRideDetail',
            'eventCategory':'marqueeRideDetail',
            'eventAction':ctaText,
            'eventLabel':nextPageURL,
            'duration':duration,
            'price':price,
            'date':date,
            'destination':destination,
            'terrain':terrain,
            'origin':origin,
            'distance':distance
          });
    }
    $(document).on('click','.marqueerideDetailregAna',function(){
        let ctaText = $(this).text().trim();
        let nextPageURL = $(this).attr("data-attr-registerUrl");
        let duration = "";
        let price = "";
        let date ="";
        let destination="";
        let terrain="";
        let distance="";
        let origin="";

        $(this).parent(".text-center").siblings(".rides-overview").children(".row").children(".col-xl").each(function(){
            if($(this).children(".inner-box").children("span").hasClass("icon-date")){
                date = $(this).children(".inner-box").children("h3").text().trim();
            }else if($(this).children(".inner-box").children("span").hasClass("icon-distance")){
                distance = $(this).children(".inner-box").children("h3").text().trim();
            }else if($(this).children(".inner-box").children("span").hasClass("icon-hilly-terrain")){
                terrain = $(this).children(".inner-box").children("h3").text().trim();
            }else if($(this).children(".inner-box").children("span").hasClass("icon-duration")){
                duration = $(this).children(".inner-box").children("h3").text().trim();
            }else if($(this).children(".inner-box").children("span").hasClass("icon-origin")){
                origin = $(this).children(".inner-box").children("h3").text().trim();
            }else if($(this).children(".inner-box").children("span").hasClass("icon-destination")){
                destination = $(this).children(".inner-box").children("h3").text().trim();
            }else if($(this).children(".inner-box").children("span").hasClass("icon-price")){
                price = $(this).children(".inner-box").children("h3").text().trim();
            }
        });
        maqueeRideAnalytics(ctaText,nextPageURL,duration,price,date,destination,terrain,distance,origin);
    });
    $(document).on('click','.marqueerideDetailsAna',function(){
        let ctaText = $(this).text().trim();
        let nextPageURL = $(this).attr("href");
        let duration = "";
        let price = "";
        let date ="";
        let destination="";
        let terrain="";
        let distance="";
        let origin="";

        $(this).parent(".text-center").siblings(".rides-overview").children(".row").children(".col-xl").each(function(){
            if($(this).children(".inner-box").children("span").hasClass("icon-date")){
                date = $(this).children(".inner-box").children("h3").text().trim();
            }else if($(this).children(".inner-box").children("span").hasClass("icon-distance")){
                distance = $(this).children(".inner-box").children("h3").text().trim();
            }else if($(this).children(".inner-box").children("span").hasClass("icon-hilly-terrain")){
                terrain = $(this).children(".inner-box").children("h3").text().trim();
            }else if($(this).children(".inner-box").children("span").hasClass("icon-duration")){
                duration = $(this).children(".inner-box").children("h3").text().trim();
            }else if($(this).children(".inner-box").children("span").hasClass("icon-origin")){
                origin = $(this).children(".inner-box").children("h3").text().trim();
            }else if($(this).children(".inner-box").children("span").hasClass("icon-destination")){
                destination = $(this).children(".inner-box").children("h3").text().trim();
            }else if($(this).children(".inner-box").children("span").hasClass("icon-price")){
                price = $(this).children(".inner-box").children("h3").text().trim();
            }
        });
        maqueeRideAnalytics(ctaText,nextPageURL,duration,price,date,destination,terrain,distance,origin);
    });
});

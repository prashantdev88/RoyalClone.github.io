$(function(){
    // $(document).on('click','.secNavDataAnaList',function(){
    //     let clickText = $(this).children("a").text().trim();
    //     let primaryText = $(this).children("a").text().trim();
    //     let nextUrl = $(this).children("a").attr("href");
    //     if(nextUrl == undefined){
    //         nextUrl = "";
    //     }
    //     let navigationItemText = $(".fsh-left").children(".fsh-head").children("h1").text().trim();
    //     if(navigationItemText == undefined || navigationItemText == ""){
    //         navigationItemText = $(".fsh-left").children(".fsh-head").children("h2").text().trim();
    //         }
    //     dataLayer.push({
    //         'event':'secondaryNavigation',
    //         'eventCategory':'secondaryNavigation',
    //         'eventAction':clickText,
    //         'eventLabel':nextUrl,
    //         'primaryText':primaryText,
    //         'headingName':navigationItemText,
    //      });
    // });

    $('.secNavDataAnaList').children("a").on('click',function(){
        let clickText = $(this).text().trim();
        let primaryText = $(this).text().trim();
        let nextUrl = $(this).attr("href");
        if(nextUrl == undefined){
            nextUrl = "";
        }
        let navigationItemText = $(".fsh-left").children(".fsh-head").children("h1").text().trim();
        if(navigationItemText == undefined || navigationItemText == ""){
            navigationItemText = $(".fsh-left").children(".fsh-head").children("h2").text().trim();
            }
        dataLayer.push({
            'event':'secondaryNavigation',
            'eventCategory':'secondaryNavigation',
            'eventAction':clickText,
            'eventLabel':nextUrl,
            'primaryText':primaryText,
            'headingName':navigationItemText,
         });
    });

        $(document).on('click','.secNavAnalyticsBtn',function(){
        let clickText = $(this).text().trim();
        let primaryText = $(this).text().trim();
        let nextUrl = $(this).attr("href");
        if(nextUrl == undefined){
            nextUrl = "";
        }
        let navigationItemText = $(".fsh-left").children(".fsh-head").children("h1").text().trim();
        if(navigationItemText == undefined || navigationItemText == ""){
            navigationItemText = $(".fsh-left").children(".fsh-head").children("h2").text().trim();
            }
        dataLayer.push({
            'event':'secondaryNavigation',
            'eventCategory':'secondaryNavigation',
            'eventAction':clickText,
            'eventLabel':nextUrl,
            'primaryText':primaryText,
            'headingName':navigationItemText,
         });
    });
 });
/*home page */
$(document).ready(function () {
    var verifyUrl = $('.myUrlLoginUnique').attr('data-url');
    var refreshTokenUrl = $('.myUrlLoginUnique').attr('refresh-url');
    var currentPageUrl = window.location.pathname;
  
    var jwtAccessToken;
    var userFetchedData;
    var fetchedUserID;
    var subDomainCookieName = $("#login-link").attr("data-runmode");
    var fetchedData = getCookie(subDomainCookieName);
    if (fetchedData) {
      userFetchedData = window.atob(fetchedData);
      userFetchedData = userFetchedData.split("#");
      fetchedUserID = userFetchedData[0];
      fetchedRtk = userFetchedData[1];
      jwtAccessToken = userFetchedData[2];
    }
  
    if (!jwtAccessToken && !fetchedUserID) {} else {
      const verifyTokenPromise = verifyToken(verifyUrl, "promise", refreshTokenUrl);
      verifyTokenPromise.then(function (value) {
        $(".toggleCta").hide();
        if (value.cluster == "EU0001" && value.ridersClubMember == true) {
            if(currentPageUrl.includes('/rides-and-club') || currentPageUrl.includes('/users')){
          $('.riderportal').hide();
          $('.dynamicUrl').attr('href', "javaScript:void(0)");
              $('.floatingButton').hide();
            }
        }
      });
  
      verifyTokenPromise.catch(function (value) {});
  
    }
  
    setTimeout(fetchbranchData, 1000);
  
    $(".secondary-navigation li a").on("click touchend", function (e) {
      window.location.href = $(this).attr("href");
      e.preventDefault();
    });
  
     $(document).on("click touchend",".secNavDataAnaList a", function(e){
          $(".secNavDataAnaList a").removeClass("active");
    //      $(".secNavDataAnaList a").css("color", "#ffffff");
         $(this).addClass("active"); 
    //     $(this).css("color", "#da291c");
     });
  
    $("#campaignBtn").click(function () {
      $(this).css("background", "grey");
      $("#campaign-form-open").show();
    });
    $(".icon-close").click(function () {
      $("#campaignBtn").css("background", "#da291c");
    });
  
    //carousel motorcycles
    $(".carousel-content-sh").each(function () {
      if (!$(this).hasClass("slick-slider")) {
        var id = $(this)
          .parent()
          .attr("data-id");
        var sub_head = "secondary-navigation-" + id;
        var sub_car = "secondary-navigation-carousel-" + id;
        $("#" + sub_car + " .carousel-content-sh").slick({
          slidesToShow: 1,
          slidesToScroll: 1,
          arrows: false,
          fade: false,
          infinite: true,
          speed: 200,
          touchThreshold: 15,
          asNavFor: "#" + sub_head + " .carousel-thumb-sh",
          responsive: [{
            breakpoint: 767,
            settings: {
              infinite: false,
              speed: 200
            }
          }]
        });
  
        var carousel_thumb_sh = $("#" + sub_head + " .carousel-thumb-sh");
        if ($(window).width() > 767) {
          carousel_thumb_sh.slick({
            slidesToShow: "auto",
            slidesToScroll: 1,
            asNavFor: "#" + sub_car + " .carousel-content-sh",
            dots: false,
            centerMode: false,
            arrows: false,
            focusOnSelect: true,
            speed: 200,
            touchThreshold: 15,
            variableWidth: true,
            draggable: false,
            infinite: true
          });
        } else {
          if ($("#" + sub_head + " .carousel-thumb-sh .c-item").length == 1) {
            carousel_thumb_sh.slick({
              slidesToShow: 1,
              slidesToScroll: 1,
              variableWidth: true,
              arrows: false,
              infinite: false,
              focusOnSelect: true,
              asNavFor: "#" + sub_car + " .carousel-content-sh"
            });
          } else if (
            $("#" + sub_head + " .carousel-thumb-sh .c-item").length == 2
          ) {
            carousel_thumb_sh.slick({
              slidesToShow: 2,
              slidesToScroll: 1,
              variableWidth: true,
              arrows: false,
              infinite: false,
              focusOnSelect: true,
              asNavFor: "#" + sub_car + " .carousel-content-sh"
            });
          } else {
            carousel_thumb_sh.slick({
              slidesToShow: 1,
              slidesToScroll: 1,
              variableWidth: true,
              speed: 200,
              touchThreshold: 15,
              infinite: false,
              arrows: false,
              focusOnSelect: true,
              asNavFor: "#" + sub_car + " .carousel-content-sh"
            });
          }
        }
      }
  });
  });
  
  function fetchbranchData() {
      if (collectionData) {
          collectionData.doc('riderPortalMembership')
              .onSnapshot(function (doc) {
                  let realtimeChange = {};
                  realtimeChange = doc.data();
                  if (realtimeChange) {
                      let branchLink = $('.dynamicUrl').attr('data-url');
                      if (branchLink.includes("/content/royal-enfield")) {
                          branchLink = branchLink.replace("/content/royal-enfield", "");
                      }
                      if (branchLink && realtimeChange.branch && realtimeChange.moderationStatus != 'REJECTED') {
                          $('.dynamicUrl').attr('href', branchLink + "?branchId=" + realtimeChange.branch._id + "&register=true");
                      } else if (branchLink && realtimeChange.moderationStatus == 'REJECTED') {
                          $('.dynamicUrl').attr('href', branchLink + "?register=false");
                      } else {
                          $('.dynamicUrl').attr('href', "javaScript:void(0)");
                      }
                  }
              })
      }
  }
  
  $(document).on("click", ".toggleCta", function () {
      $("body").toggleClass("login_show");
      $(".nav-hamburger").removeClass("is-active");
      $(".nav-primary").removeClass("np-open");
  
      //Remove Sticky Links
      $(".sticky-links-box").removeClass("open sl-head-show");
  
      //Close Nav Dropdown
      $(".nav-primary .has-children").removeClass("active");
      $(".nav-primary .has-children")
          .siblings()
          .find(".nav-secondary")
          .removeClass("nav-dropdown");
  
      //Close Nav Dropdown for Mobile
      $(".nav-hamburger").removeClass("is-active");
      $(".nav-primary").removeClass("np-open");
      $("body").removeClass("body-scroll-stop");
  
      //Language dropdown close
      $("body").removeClass("language-open");
  
      //Close Secondary Nav
      $("body").removeClass("secondary-sticky-nav-open");
  });
  
  
  function fetchbranchData() {
    if (collectionData) {
      collectionData.doc('riderPortalMembership')
        .onSnapshot(function (doc) {
          let realtimeChange = {};
          realtimeChange = doc.data();
          if (realtimeChange) {
            let branchLink = $('.dynamicUrl').attr('data-url');
            if (branchLink) {
              if (branchLink.includes("/content/royal-enfield")) {
                branchLink = branchLink.replace("/content/royal-enfield", "");
              }
              if (branchLink && realtimeChange.branch && realtimeChange.moderationStatus != 'REJECTED') {
                $('.dynamicUrl').attr('href', branchLink + "?branchId=" + realtimeChange.branch._id + "&register=true");
              } else if (branchLink && realtimeChange.moderationStatus == 'REJECTED') {
                $('.dynamicUrl').attr('href', branchLink + "?register=false");
              }
            } else {
              $('.dynamicUrl').attr('href', "javaScript:void(0)");
            }
          }
        })
    }
  }

  
  $("#overlay-btn").click(function () {
    $(".overlay-form").toggle();
  });

